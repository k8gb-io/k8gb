apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  name: roundrobin-lbservice
spec:
  namespace: roundrobin-lbservice
  steps:
    - name: namespace EU
      description: create namespace on EU cluster
      cluster: eu
      use:
        template: ../../step-templates/namespace.yaml
    - name: namespace US
      description: create namespace on US cluster
      cluster: us
      use:
        template: ../../step-templates/namespace.yaml
    - name: init EU
      description: setup podinfo application and GSLB on EU cluster
      cluster: eu
      use:
        template: ../../step-templates/init-lbservice.yaml
    - name: init US
      description: setup podinfo application and GSLB on US cluster
      cluster: us
      use:
        template: ../../step-templates/init-lbservice.yaml
    - name: DNS resolves to both clusters
      description: verify that coredns on both clusters resolves to both EU and US
      cluster: eu
      use:
        template: ../../step-templates/assert-dns.yaml
